<div th:if="${content == 'customers'}">
    <style>
        .customers-content {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.3) !important;
        }

        .customers-header {
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .customers-header i {
            margin-right: 10px;
        }

        .customers-top-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .customers-btn-add {
            background-color: #ff6b35;
            color: white;
            font-weight: 500;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
        }

        .customers-btn-add:hover {
            background-color: #e55c2b;
            color: white;
        }

        .customers-search-box {
            position: relative;
            width: 280px;
        }

        .customers-search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .customers-search-box input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.1);
        }

        .customers-search-box .fa-search {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 16px;
        }

        .customers-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .customers-table {
            margin-bottom: 0;
        }

        .customers-table th,
        .customers-table td {
            text-align: center;
            vertical-align: middle;
            padding: 15px 12px;
            font-size: 14px;
        }

        .customers-table thead th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }

        .customers-table tbody td {
            border-bottom: 1px solid #f0f0f0;
        }

        .customers-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .customers-status-active {
            background-color: #d1f2d9;
            color: #0a3622;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            min-width: 90px;
            text-align: center;
            border: 1px solid #a6e9a6;
        }

        .customers-status-deactivate {
            background-color: #f8d7da;
            color: #842029;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            min-width: 90px;
            text-align: center;
            border: 1px solid #f1aeb5;
        }

        .customers-btn-action {
            background: none;
            border: none;
            margin: 0 3px;
            font-size: 16px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .customers-btn-lock i.text-success {
            color: #198754 !important;
        }

        .customers-btn-lock i.text-danger {
            color: #dc3545;
        }

        .customers-btn-edit i {
            color: #ffc107;
        }

        .customers-btn-delete i {
            color: #dc3545;
        }

        .customers-action-icons {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .customers-pagination-container {
            margin-top: 25px;
            display: flex;
            justify-content: center;
        }

        .customers-pagination {
            margin: 0;
        }

        .customers-pagination .page-item {
            margin: 0 2px;
        }

        .customers-pagination .page-link {
            border: 1px solid #dee2e6;
            color: #6c757d;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
        }

        .customers-pagination .page-item.active .page-link {
            background-color: #ff6b35;
            border-color: #ff6b35;
            color: white;
        }

        .customers-pagination .page-link:hover {
            background-color: #f8f9fa;
            border-color: #dee2e6;
            color: #495057;
        }

        .customers-pagination .page-item.active .page-link:hover {
            background-color: #e55c2b;
            border-color: #e55c2b;
        }

        .customers-modal .modal-dialog {
            max-width: 500px;
        }

        .customers-modal .modal-header {
            border-bottom: 1px solid #dee2e6;
        }

        .customers-modal .modal-footer {
            border-top: 1px solid #dee2e6;
        }

        .customers-modal .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }

        .customers-modal .btn-warning {
            background-color: #ff6b35;
            border-color: #ff6b35;
            color: white;
        }

        .customers-modal .btn-warning:hover {
            background-color: #e55c2b;
            border-color: #e55c2b;
        }

        .customers-modal .form-control:focus {
            border-color: #ff6b35;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }

        .customers-modal .invalid-feedback {
            display: block;
        }

        .input-group .form-control {
            border-top-left-radius: 25px;
            border-bottom-left-radius: 25px;
        }

        .input-group .btn {
            border-top-right-radius: 25px;
            border-bottom-right-radius: 25px;
        }

        .search-rounded {
            border: 1px solid #ced4da;
            border-radius: 50px;
            overflow: hidden;
            background-color: white;
            height: 45px;
        }

        .search-rounded input.form-control {
            border: none;
            box-shadow: none;
            border-radius: 0;
            padding-left: 20px;
            font-size: 14px;
        }

        .search-rounded .btn {
            border: none;
            border-left: 1px solid #ddd;
            border-radius: 0;
            padding: 0 16px;
            background-color: transparent;
        }

        .search-rounded .btn:hover {
            background-color: transparent;
        }

    </style>

    <div class="customers-content">
        <!-- Tiêu đề -->
        <div class="customers-header">
            <i class="fas fa-users"></i> Customer
        </div>

        <!-- Thanh trên: Nút và tìm kiếm -->
        <div class="customers-top-bar">
            <!-- Nút Add -->
            <button class="customers-btn-add" data-bs-toggle="modal" data-bs-target="#customerModal" id="btnAddCustomer">Add Customer</button>
            <form th:action="@{/admin/customers/searchCustomer}" method="post" class="customers-search-box">
                <div class="input-group search-rounded">
                    <input type="text" name="customerName" class="form-control border-0" placeholder="Tìm kiếm theo tên..."
                           th:value="${keywordName}">
                    <button class="btn btn-outline-secondary border-0" type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Bảng -->
        <div class="customers-table-container">
            <table class="customers-table table table-hover">
                <thead class="table-light">
                <tr>
                    <th>STT</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="customer, stat : ${customers}">
                    <td th:text="${stat.index + 1}">1</td>
                    <td th:text="${customer.name}">Leanne Graham</td>
                    <td th:text="${customer.email}">Sincere@gmail.com</td>
                    <td th:text="${customer.phone}">0987654321</td>
                    <td th:text="${customer.address}">Alabama</td>
                    <td>
                        <span th:if="${customer.status}" class="customers-status-active">Active</span>
                        <span th:unless="${customer.status}" class="customers-status-deactivate">Deactivate</span>
                    </td>
                    <td>
                        <div class="customers-action-icons">
                            <button type="button" class="customers-btn-action customers-btn-lock"
                                    th:title="${customer.status ? 'Khóa' : 'Mở khóa'}"
                                    data-bs-toggle="modal"
                                    th:data-bs-target="'#lockModal' + ${customer.id}">
                                <i class="fas"
                                   th:classappend="${customer.status} ? ' fa-lock-open text-success' : ' fa-lock text-danger'"></i>
                            </button>
                            <button type="button"
                                    class="customers-btn-action customers-btn-edit"
                                    title="Edit"
                                    th:data-id="${customer.id}"
                                    th:data-name="${customer.name}"
                                    th:data-email="${customer.email}"
                                    th:data-phone="${customer.phone}"
                                    th:data-address="${customer.address}"
                            >
                                <i class="bi bi-pencil-square"></i>
                            </button>
                        </div>

                        <!-- Modal Khóa/Mở khóa -->
                        <div class="modal fade" th:id="'lockModal' + ${customer.id}" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" th:text="${customer.status ? 'Xác nhận khóa tài khoản' : 'Xác nhận mở khóa tài khoản'}"></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>
                                            <span th:text="'Bạn có chắc chắn muốn ' + (${customer.status} ? 'khóa' : 'mở khóa') + ' khách hàng '"></span>
                                            <strong th:text="${customer.name}"></strong>
                                            <span> không?</span>
                                        </p>
                                        <p class="text-danger"><small>Thao tác này sẽ ảnh hưởng đến việc đăng nhập của khách hàng.</small></p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                        <form th:action="@{/admin/customers/update-status}" method="post">
                                            <input type="hidden" name="id" th:value="${customer.id}" />
                                            <input type="hidden" name="status" th:value="${!customer.status}" />
                                            <button type="submit"
                                                    th:classappend="${customer.status ? 'btn btn-danger' : 'btn btn-success'}"
                                                    th:text="${customer.status ? 'Khóa' : 'Mở khóa'}">
                                                Khóa
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(customers)}">
                    <td colspan="8" class="text-center py-4">
                        <i class="fas fa-user-times fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No customers found</p>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Bootstrap Modal -->
        <div class="modal customers-modal" id="customerModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form id="customerForm" th:action="@{/admin/customers/save}" method="post" th:object="${customerDTO}">
                        <input type="hidden" th:field="*{id}">
                        <div class="modal-header">
                            <h5 class="modal-title" th:text="${editMode} ? 'Update Customer' : 'Add Customer'">Add Customer</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Name <span class="text-danger">*</span></label>
                                <input type="text" th:field="*{name}" class="form-control"
                                       th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email <span class="text-danger">*</span></label>
                                <input type="email" th:field="*{email}"
                                       th:classappend="${#fields.hasErrors('email')} ? 'is-invalid'"
                                       class="form-control">
                                <div class="invalid-feedback"
                                     th:if="${#fields.hasErrors('email')}"
                                     th:errors="*{email}">Lỗi</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Phone <span class="text-danger">*</span></label>
                                <input type="tel" th:field="*{phone}"
                                       th:classappend="${#fields.hasErrors('phone')} ? 'is-invalid'"
                                       class="form-control">
                                <div class="invalid-feedback"
                                     th:if="${#fields.hasErrors('phone')}"
                                     th:errors="*{phone}">Lỗi</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address <span class="text-danger">*</span></label>
                                <textarea th:field="*{address}" class="form-control" rows="3"></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-warning" th:text="${editMode} ? 'Update' : 'Save'">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Phân trang -->
        <div class="customers-pagination-container">
            <nav>
                <ul class="customers-pagination pagination">
                    <li class="page-item"><a class="page-link" href="#"><i class="fas fa-angle-left"></i></a></li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item active"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item"><a class="page-link" href="#">6</a></li>
                    <li class="page-item"><a class="page-link" href="#">7</a></li>
                    <li class="page-item"><a class="page-link" href="#"><i class="fas fa-angle-right"></i></a></li>
                </ul>
            </nav>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function () {
            const modalEl = document.getElementById('customerModal');
            let modalInstance;

            // Nếu modal tồn tại, tạo 1 instance duy nhất
            if (modalEl) {
                modalInstance = bootstrap.Modal.getInstance(modalEl);
                if (!modalInstance) {
                    modalInstance = new bootstrap.Modal(modalEl);
                }

                // Nếu cần show modal ban đầu
                let showModal = /*[[${showModal}]]*/ false;
                if (showModal) {
                    modalInstance.show();
                }

                // Reset form khi modal đóng
                modalEl.addEventListener('hidden.bs.modal', function () {
                    resetCustomerForm();
                });
            }

            const form = document.getElementById('customerForm');
            const nameInput = form?.querySelector('[name="name"]');
            const emailInput = form?.querySelector('[name="email"]');
            const phoneInput = form?.querySelector('[name="phone"]');
            const addressInput = form?.querySelector('[name="address"]');

            let idHiddenInput = form?.querySelector('input[name="id"]');
            if (form && !idHiddenInput) {
                idHiddenInput = document.createElement('input');
                idHiddenInput.type = 'hidden';
                idHiddenInput.name = 'id';
                form.appendChild(idHiddenInput);
            }

            // Reset form function
            function resetCustomerForm() {
                if (!form) return;
                form.reset();
                if (idHiddenInput) idHiddenInput.value = '';

                // Remove validation errors
                form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
                form.querySelectorAll('.invalid-feedback').forEach(el => el.textContent = '');

                // Reset title/button
                const modalTitle = document.querySelector('#customerModal .modal-title');
                const submitBtn = document.querySelector('#customerModal button[type="submit"]');
                if (modalTitle) modalTitle.textContent = 'Add Customer';
                if (submitBtn) submitBtn.textContent = 'Save';
            }

            // Add Customer button
            document.getElementById('btnAddCustomer')?.addEventListener('click', function () {
                resetCustomerForm();
                modalInstance?.show();
            });

            // Cancel button
            document.querySelector('#customerModal .btn-secondary')?.addEventListener('click', function () {
                resetCustomerForm();
            });

            // Edit buttons
            const editButtons = document.querySelectorAll('.customers-btn-edit');
            editButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    const email = this.getAttribute('data-email');
                    const phone = this.getAttribute('data-phone');
                    const address = this.getAttribute('data-address');

                    if (nameInput) nameInput.value = name;
                    if (emailInput) emailInput.value = email;
                    if (phoneInput) phoneInput.value = phone;
                    if (addressInput) addressInput.value = address;
                    if (idHiddenInput) idHiddenInput.value = id;

                    const modalTitle = document.querySelector('#customerModal .modal-title');
                    const submitBtn = document.querySelector('#customerModal button[type="submit"]');
                    if (modalTitle) modalTitle.textContent = 'Update Customer';
                    if (submitBtn) submitBtn.textContent = 'Update';

                    modalInstance?.show();
                });
            });
        });
        /*]]>*/
    </script>
</div>